"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Address{constructor(t,e,s,i){this.separator="Â»",this.province=t,this.subdistrict=e,this.district=s,this.zipcode=i}setGeo(t,e,s){this.districtCode=t,this.subdistrictCode=e,this.provinceCode=s}addressToString(t){return[this.subdistrict,this.district,this.province,this.zipcode].join(` ${t||this.separator} `)}}const preprocess=t=>{let e=[],s=[];const i=[];let r;return t.lookup&&t.words&&(e=t.lookup.split("|"),s=t.words.split("|"),t=t.data),r=t=>{return"number"==typeof t&&(t=e[t]),t.replace(/[A-Z]/gi,(function(t){const e=t.charCodeAt(0);return s[e<97?e-65:26+e-97]}))},t.map(t=>{let e=1;3===t.length&&(e=2),t[e].map(s=>{s[e].map(o=>{o[e]=o[e]instanceof Array?o[e]:[o[e]],o[e].map(c=>{const n=new Address(r(t[0]),r(s[0]),r(o[0]),c);2===e&&n.setGeo(o[1]||!1,s[1]||!1,t[1]||!1),i.push(n)})})})}),i};class LoadDB{load(t,e,s=!1){if("string"!==(typeof t).toLowerCase())return this.db=s?preprocess(t):t,this.db;let i;i=null==t||void 0===t?"./database/db.json":t;const r=this.loadData(i,e);return"json"===e&&(this.db=s?preprocess(r):r),this.db}loadData(t,e){if("json"===e){return require(t)}throw new Error("This type is not supported!")}}const loadDB=new LoadDB;class AddressService{constructor(){this.multilingual=!1,this.language="en"}loadData(t,e,s=!1,i=!0,r){r&&(this.language=r),this.multilingual=s,this.processedDb=loadDB.load(t,e,i)}query(t){const e={district:t.district?new RegExp(t.district.toString().toLowerCase().trim(),"g"):/.*/g,province:t.province?new RegExp(t.province.toString().toLowerCase().trim(),"g"):/.*/g,subdistrict:t.subdistrict?new RegExp(t.subdistrict.toString().toLowerCase().trim(),"g"):/.*/g,zipcode:t.zipcode?new RegExp(t.zipcode.toString().toLowerCase().trim(),"g"):/.*/g};if(this.multilingual)try{return this.processedDb.filter(t=>(t[`province_${this.language}`]||" ").toString().toLowerCase().match(e.province)&&(t[`subdistrict_${this.language}`]||" ").toString().toLowerCase().match(e.subdistrict)&&(t[`district_${this.language}`]||" ").toString().toLowerCase().match(e.district)&&(t.zipcode||" ").toString().toLowerCase().match(e.zipcode)).map(t=>({district:t[`district_${this.language}`],province:t[`province_${this.language}`],subdistrict:t[`subdistrict_${this.language}`],zipcode:t.zipcode}))}catch(t){return[]}else try{return this.processedDb.filter(t=>(t.province||" ").toString().toLowerCase().match(e.province)&&(t.subdistrict||" ").toString().toLowerCase().match(e.subdistrict)&&(t.district||" ").toString().toLowerCase().match(e.district)&&(t.zipcode||" ").toString().toLowerCase().match(e.zipcode))}catch(t){return[]}}queryByType(t,e){return this.uniq_fast(this.query(t),e)}uniq_fast(t,e){const s={},i=[],r=t.length;let o=0;for(let c=0;c<r;c++){const r=t[c][e];1!==s[r]&&(s[r]=1,i[o++]=t[c][e])}return i}}const addressService=new AddressService;exports.AddressService=AddressService,exports.default=addressService;
